<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-list/iron-list.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">


<!--



Example:

    <buuild-source-select>
        <buuild-source-select-item tree-id="99" categories="abc,def"></buuild-source-select-item>
    </buuild-source-select>

@demo
-->
<dom-module id="buuild-source-select">

  <style>
    :host {
      display: block;
      box-sizing: border-box;
    }

  </style>

  <template>
    <content></content>
      <button id="add">Hinzufügen</button>

	<paper-dialog id="selectTreeId">
		  <h2>Auswahl Quelle</h2>


          <paper-input label="Suche"></paper-input>

		  <paper-dialog-scrollable>
  
              <iron-ajax url="http://dev.nacworld.net:8000/admin/api/select_trees" params='{"filter_meta_kind": "article"}' last-response="{{data}}" auto></iron-ajax>
				<iron-list items="[[data]]" as="item">
			    <template>
                    <paper-button on-click="doSelectTreeId" data-tree-id$="[[item.tree_id]]">[[item.name]] [[item.description]]</paper-button>
		    	</template>
		    </iron-list>

  		  </paper-dialog-scrollable>
	    	<div class="buttons">
		    <paper-button dialog-dismiss>Abbrechen</paper-button>
	  </div>
	</paper-dialog>	
   

	<paper-dialog id="selectCategoriesUuid">
		  <h2>Auswahl Kategorien</h2>


          <paper-input label="Suche"></paper-input>

		  <paper-dialog-scrollable>
  
				<iron-ajax url="http://dev.nacworld.net:8000/admin/api/select_categories" last-response="{{data}}" auto></iron-ajax>
				<iron-list items="[[data]]" as="item">
			    <template>
                    <paper-checkbox value$="[[item.category_uuid]]">[[item.name]]</paper-checkbox>
		    	</template>
		    </iron-list>

  		  </paper-dialog-scrollable>
	    	<div class="buttons">
		    <paper-button dialog-dismiss>Abbrechen</paper-button>
    		<paper-button dialog-confirm>Übernehmen</paper-button>
	  </div>
	</paper-dialog>	


  </template>

</dom-module>

<dom-module id="buuild-source-select-item">

  <style>
    :host {
      display: block;
      box-sizing: border-box;
      border-bottom: 1px solid #eee;
      line-height: 150%;
  }
   
  :host ::content em {
    
      display: inline-block;
      background: #eee;
      padding: 2px 10px;
      font-size: 12px;
      line-height: 100%;    
      font-style: normal;
  }

  </style>

  <template>
    <content></content>

    <paper-button id="delete" dialog-confirm>Löschen</paper-button>
	
	<paper-dialog id="deleteConfirm" class="shadow-2dp">
          <h2>Selektion löschen</h2>
	    	<div class="buttons">
		    <paper-button dialog-dismiss>Abbrechen</paper-button>
    		<paper-button dialog-confirm>Löschen</paper-button>
	  </div>
	</paper-dialog>	
 

  </template>

</dom-module>

<script>

  Polymer({

    is: 'buuild-source-select',

    properties: {

        deletable: {
            
            type: Boolean,
            value: true
        },
    },

    // Element Lifecycle

    ready: function() {
      // `ready` is called after all elements have been configured, but
      // propagates bottom-up. This element's children are ready, but parents
      // are not.
      //
      // This is the point where you should make modifications to the DOM (when
      // necessary), or kick off any processes the element wants to perform.
    },

    attached: function() {
      // `attached` fires once the element and its parents have been inserted
      // into a document.
      //
      // This is a good place to perform any work related to your element's
      // visual state or active behavior (measuring sizes, beginning animations,
      // loading resources, etc).

        var these = this;

       // Assign items to element
       
        these.$.add.addEventListener('click', these.addItem.bind(these));
    },

    detached: function() {
      // The analog to `attached`, `detached` fires when the element has been
      // removed from a document.
      //
      // Use this to clean up anything you did in `attached`.
    },

    // Element Behavior
      
    items: function() {
    
        var these =this;
        return these.getEffectiveChildren();
    },

    addItem: function() {

		var these = this;
		these.selectTreeId();        

    },

    // Selection dialog for trees 
    selectTreeId: function() {

		var these = this;


        var select_dialog = these.$.selectTreeId;

        select_dialog.addEventListener('iron-overlay-closed', function(e) {

            if ( e.detail.confirmed ) {

               console.dir(e) ;
            }
            
                

        });
		
        select_dialog.open();
        


    },

    doSelectTreeId: function(e) {

        var these = this;
        
        var select_dialog = these.$.selectTreeId;
        console.log(e.target.getAttribute('data-tree-id'));
        select_dialog.close();
        these.$.selectCategoriesUuid.open();
    },

    // Selection dialog for categories 
    selectCategoriesUuid: function() {

        var these = this;
        
        var select_categories_uuid = these.$.selectCategoriesUuid;

        select_categories_uuid.addEventListener('iron-overlay-closed', function(e) {

            if ( e.detail.confirmed ) {

               console.dir(e) ;
            }
                           

        });
		
        select_categories_uuid.open();

    },

  });

 Polymer({

    is: 'buuild-source-select-item',

    properties: {

        treeId: {

            type: Number
        },

        categoriesUuid: {

            type: String
        }

    },

    // Element Lifecycle

    ready: function() {
      // `ready` is called after all elements have been configured, but
      // propagates bottom-up. This element's children are ready, but parents
      // are not.
      //
      // This is the point where you should make modifications to the DOM (when
      // necessary), or kick off any processes the element wants to perform.
    },

    attached: function() {
      // `attached` fires once the element and its parents have been inserted
      // into a document.
      //
      // This is a good place to perform any work related to your element's
      // visual state or active behavior (measuring sizes, beginning animations,
      // loading resources, etc).

        var these = this;

        var deleteButton = these.$.delete;

        deleteButton.addEventListener('click', these.removeItem.bind(these) );

   },

    detached: function() {
      // The analog to `attached`, `detached` fires when the element has been
      // removed from a document.
      //
      // Use this to clean up anything you did in `attached`.

   
    },

    // Remove item
    removeItem: function() {

        var these = this;

        these.$.deleteConfirm.addEventListener('iron-overlay-closed', function(e) {

            if ( e.detail.confirmed ) { 
                var parent = these.parentNode;
                Polymer.dom(parent).removeChild(these);
            } 
        });
        
        these.$.deleteConfirm.open()
        
       
    },

  });


</script>
